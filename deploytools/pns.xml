<project name="SIA JARSIGN" default="packAndSign" basedir=".">
	<property environment="env."/>
	<property name="encoding" value="GBK" />
	<property name="uploaddir" value="${env.upload_dir}" />
	<target name="packAndSign" >
		<antcall target="pan200">
			<param name="target_path" value="${target_path}"/>
			<param name="target_jarfile" value="${jar_file}"/>
		</antcall>
	</target>

	<target name="sync">
		<echo message="TODO: need to sync jar ${target_jarfile} " />
	</target>
	<target name="pan200"  >

				<taskdef name="p200ant"
					classname="de.matthiasmann.p200ant.P200AntTask" classpath="DigitCertAndJarSign/p200ant.jar" />

				<delete file="${target_path}/${target_jarfile}.pack.gz" />

				<fileset id="jars2pack" dir="${target_path}/">
					<include name="**/${target_jarfile}"/>
					<!--<exclude name="lwjgl-*.jar"/>-->
				</fileset>

				<p200ant repack="true" segmentLimit="-1" >
					 <fileset refid="jars2pack"/>
				</p200ant>

				<signjar jar="${target_path}/${target_jarfile}" keystore="DigitCertAndJarSign/sia.jks"
						storepass="sia04032021" alias="sia" keypass="sia04032021" />

				<p200ant destdir="${target_path}/" segmentLimit="-1" >
					<fileset refid="jars2pack"/>
				</p200ant>

			<!-- copy pack.gz files to upload dire -->
			<copy todir="${uploaddir}" overwrite="true" failonerror="true" >
				<fileset dir="${target_path}" casesensitive="no">
					<include name="${target_jarfile}.pack.gz" />
					<!-- include name="${target_jarfile}" / -->
				</fileset>
			</copy>

			<delete file="${target_path}/${target_jarfile}.pack.gz" />

	</target>
</project> 